import{r as e}from"./ui-vendor-BTYnCCVH.js";import{u as a}from"./index-zo8qnSR5.js";const t=async e=>{const a=await fetch("/api/phase12/payments/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const e=await a.json().catch(()=>({detail:"Failed to create order"}));throw new Error(e.detail||"Failed to create order")}return a.json()},n=async e=>{const a=await fetch("/api/phase12/payments/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const e=await a.json().catch(()=>({detail:"Payment verification failed"}));throw new Error(e.detail||"Payment verification failed")}return a.json()},r=async()=>{const e=await fetch("/api/phase12/payments/config",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to fetch payment config");return e.json()},i=()=>{const[i,o]=e.useState(!1),[s,c]=e.useState(!1),{toast:l}=a(),d=e.useCallback(()=>new Promise(e=>{if(window.Razorpay)return c(!0),void e(!0);const a=document.createElement("script");a.src="https://checkout.razorpay.com/v1/checkout.js",a.async=!0,a.onload=()=>{c(!0),e(!0)},a.onerror=()=>{c(!1),e(!1)},document.body.appendChild(a)}),[]);return{openPayment:e.useCallback(async e=>{var a;try{o(!0);if(!(await d()))throw new Error("Failed to load payment gateway");const a=await r();if(!a.enabled)throw new Error("Payment gateway is not configured");const i=await t({amount:e.amount,item_type:e.item_type,item_id:e.item_id,item_name:e.item_name,user_email:e.user_email,user_name:e.user_name,user_phone:e.user_phone}),s={key:a.key_id,amount:100*i.amount,currency:i.currency,name:"A-Cube Mental Health",description:e.item_name,order_id:i.razorpay_order_id,prefill:{name:e.user_name||"",email:e.user_email||"",contact:e.user_phone||""},theme:{color:"#667eea"},handler:async a=>{var t,r;try{const r=await n({razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature});if(!r.success)throw new Error("Payment verification failed");l({title:"Payment Successful",description:"Your payment has been processed successfully."}),null==(t=e.onSuccess)||t.call(e,r.transaction_id)}catch(i){l({title:"Payment Verification Failed",description:i.message||"Failed to verify payment",variant:"destructive"}),null==(r=e.onFailure)||r.call(e,i.message)}finally{o(!1)}},modal:{ondismiss:()=>{var a;l({title:"Payment Cancelled",description:"You cancelled the payment process.",variant:"default"}),null==(a=e.onFailure)||a.call(e,"Payment cancelled by user"),o(!1)}}};new window.Razorpay(s).open()}catch(i){l({title:"Payment Failed",description:i.message||"Failed to initiate payment",variant:"destructive"}),null==(a=e.onFailure)||a.call(e,i.message),o(!1)}},[d,l]),isLoading:i,isInitialized:s}};export{i as u};
